FROM python:3.12-slim

WORKDIR /app

# Dependencies
RUN pip install --no-cache-dir grpcio grpcio-tools clickhouse-driver

# Copy proto and generate (optional; generated code is committed)
COPY libs/onetake_proto libs/onetake_proto
COPY services/analytics_ingest services/analytics_ingest
COPY scripts scripts

ENV PYTHONPATH=/app:/app/libs/onetake_proto

CMD ["python", "-m", "services.analytics_ingest.main"]
